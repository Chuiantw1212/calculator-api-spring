# Calculator API Spring

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Spring Boot çš„è²¡å‹™è¨ˆç®—æ©Ÿ APIï¼Œä¸»è¦åŠŸèƒ½ç‚ºè¤‡åˆ©è¨ˆç®— (Compound Interest)ã€‚
å°ˆæ¡ˆæ¡ç”¨ **MyBatis** ä½œç‚º ORM æ¡†æ¶ï¼Œé€£æ¥è‡³ **Neon (PostgreSQL)** é›²ç«¯è³‡æ–™åº«ï¼Œä¸¦æ•´åˆ **Firebase Admin SDK** é€²è¡Œå¾Œç«¯æ“´å……æœå‹™ã€‚

## ğŸ› ï¸ æŠ€è¡“æ£§ (Tech Stack)

* **Java**: 17
* **Framework**: Spring Boot 3.3.0
* **ORM**: MyBatis Spring Boot Starter 3.0.3
* **Database**: PostgreSQL (Neon Serverless)
* **Cloud Service**: Firebase Admin SDK (Java)
* **Documentation**: SpringDoc OpenAPI (Swagger UI)
* **Tooling**: Maven, Lombok

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Getting Started)

### 1. è³‡æ–™åº«åˆå§‹åŒ– (Database Setup)

è«‹åœ¨ä½ çš„ PostgreSQL è³‡æ–™åº«ä¸­åŸ·è¡Œä»¥ä¸‹ SQL ä»¥å»ºç«‹ç´€éŒ„è¡¨ï¼š

```sql
CREATE TABLE IF NOT EXISTS calculation_records (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    principal DECIMAL(19, 2), -- æœ¬é‡‘
    rate DECIMAL(5, 4),       -- åˆ©ç‡
    years INT,                -- å¹´åˆ†
    result DECIMAL(19, 2),    -- è¨ˆç®—çµæœ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

### 2. ç’°å¢ƒè®Šæ•¸èˆ‡å¤–éƒ¨é‡‘é‘°è¨­å®š (Configuration & Secrets)

ç‚ºäº†ç¢ºä¿è³‡å®‰ï¼Œæœ¬å°ˆæ¡ˆ **ä¸å°‡æ•æ„Ÿè³‡è¨Šæ˜æ–‡å¯«å…¥** ç¨‹å¼ç¢¼æˆ–è¨­å®šæª”ã€‚è«‹å‹™å¿…å®Œæˆä»¥ä¸‹å…©é …è¨­å®šï¼š

#### **A. è¨­å®šç’°å¢ƒè®Šæ•¸ (Database)**

è«‹åœ¨ IDE (å¦‚ Eclipse/IntelliJ) çš„ `Run Configurations` -> `Environment` ä¸­è¨­å®šä»¥ä¸‹è®Šæ•¸ï¼š

| è®Šæ•¸åç¨± (Variable) | èªªæ˜ (Description) | ç¯„ä¾‹å€¼ (Example) |
| --- | --- | --- |
| **DB_URL** | JDBC é€£ç·šå­—ä¸² | `jdbc:postgresql://<HOST>/neondb?sslmode=require` |
| **DB_USERNAME** | è³‡æ–™åº«å¸³è™Ÿ | `neondb_owner` |
| **DB_PASSWORD** | è³‡æ–™åº«å¯†ç¢¼ | `********` |

#### **B. Firebase é‡‘é‘°æº–å‚™ (Firebase Admin SDK)**

æœ¬å°ˆæ¡ˆéœ€æ‰‹å‹•é…ç½® Firebase æ†‘è­‰ï¼Œè«‹ä¾åºåŸ·è¡Œï¼š

1. å‰å¾€ [Firebase Console](https://console.firebase.google.com/)ã€‚
2. é€²å…¥ **å°ˆæ¡ˆè¨­å®š > æœå‹™å¸³æˆ¶ (Service Accounts)**ã€‚
3. é»æ“Š **ã€Œç”¢ç”Ÿæ–°çš„ç§å¯†é‡‘é‘°ã€** ä¸¦ä¸‹è¼‰ JSON æª”æ¡ˆã€‚
4. å°‡è©²æª”æ¡ˆé‡æ–°å‘½åç‚º **`serviceAccountKey.json`**ã€‚
5. å°‡æª”æ¡ˆæ”¾å…¥å°ˆæ¡ˆè·¯å¾‘ï¼š`src/main/resources/serviceAccountKey.json`ã€‚

> âš ï¸ **è³‡å®‰è­¦ç¤º**ï¼š`serviceAccountKey.json` åŒ…å«å°ˆæ¡ˆæœ€é«˜æ¬Šé™ï¼Œæœ¬å°ˆæ¡ˆå·²å°‡å…¶åŠ å…¥ `.gitignore`ã€‚è«‹å‹¿å°‡æ­¤é‡‘é‘°ä¸Šå‚³è‡³ GitHub ç­‰å…¬å…±å„²å­˜åº«ã€‚

### 3. è¨­å®šæª”çµæ§‹ (application.yaml)

```yaml
spring:
  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.en_chu.calculator_api_spring.model

```

---

## ğŸ“– API æ–‡ä»¶ (Swagger)

å°ˆæ¡ˆå•Ÿå‹•å¾Œï¼Œå¯é€é Swagger UI é€²è¡Œè¦–è¦ºåŒ–æ¸¬è©¦ï¼š

* **URL**: `http://localhost:8888/swagger-ui/index.html`

---

## ğŸ”§ å¸¸è¦‹å•é¡Œèˆ‡æŒ‡ä»¤ (Troubleshooting)

### 1. é€£æ¥åŸ è¢«ä½”ç”¨ (Port 8888 already in use)

è‹¥é‡æ–°å•Ÿå‹•æ™‚ç™¼ç¾ Port 8888 è¢«ä½”ç”¨ï¼Œè«‹åœ¨ Windows æŒ‡ä»¤è¡ŒåŸ·è¡Œï¼š

```cmd
netstat -ano | findstr :8888
taskkill /F /PID <æŸ¥è©¢åˆ°çš„PID>

```

### 2. Firebase åˆå§‹åŒ–å¤±æ•—

è‹¥å•Ÿå‹•æ™‚å™´å‡º `FileNotFoundException`ï¼Œè«‹ç¢ºèª `serviceAccountKey.json` æ˜¯å¦å·²æ­£ç¢ºæ”¾ç½®æ–¼ `src/main/resources/` ç›®éŒ„ä¸‹ã€‚

### 3. Spring Boot ç‰ˆæœ¬ç›¸å®¹æ€§

æœ¬å°ˆæ¡ˆé–å®š Spring Boot **3.3.0**ï¼Œä»¥ç¢ºä¿èˆ‡ MyBatis 3.0.3 çš„ç©©å®šç›¸å®¹æ€§ã€‚è‹¥å‡ç´šè‡³æ›´é«˜ç‰ˆæœ¬ï¼Œè«‹æ³¨æ„ç›¸é—œä¾è³´æ˜¯å¦æ”¯æ´ã€‚
