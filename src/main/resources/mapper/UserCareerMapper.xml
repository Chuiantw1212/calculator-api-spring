<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.en_chu.calculator_api_spring.mapper.UserCareerMapper">

	<update id="updateByUid">
    <![CDATA[
        UPDATE user_careers 
        SET 
            base_salary = #{baseSalary},
            other_allowance = #{otherAllowance},
            labor_insurance = #{laborInsurance},
            health_insurance = #{healthInsurance},
            other_deduction = #{otherDeduction},
            pension_rate = #{pensionRate},
            pension_amount = #{pensionAmount},
            stock_deduction = #{stockDeduction},
            stock_company_match = #{stockCompanyMatch},
            updated_at = CURRENT_TIMESTAMP
        WHERE 
            firebase_uid = #{firebaseUid}
    ]]>
	</update>

	<insert id="insert">
    <![CDATA[
        INSERT INTO user_careers (
            user_id, firebase_uid, 
            base_salary, other_allowance, 
            labor_insurance, health_insurance, other_deduction,
            pension_rate, pension_amount,
            stock_deduction, stock_company_match,
            created_at, updated_at
        ) VALUES (
            (SELECT id FROM users WHERE firebase_uid = #{firebaseUid}), 
            #{firebaseUid},
            #{baseSalary}, #{otherAllowance},
            #{laborInsurance}, #{healthInsurance}, #{otherDeduction},
            #{pensionRate}, #{pensionAmount},
            #{stockDeduction}, #{stockCompanyMatch},
            CURRENT_TIMESTAMP, CURRENT_TIMESTAMP
        )
    ]]>
	</insert>

	<select id="selectByUid"
		resultType="com.en_chu.calculator_api_spring.entity.UserCareer">
    <![CDATA[
        SELECT * FROM user_careers WHERE firebase_uid = #{firebaseUid}
    ]]>
	</select>

</mapper>