# ===================================================================
# 正式環境配置 (Production Profile)
# ===================================================================

server:
  port: 8888                             # 設定後端服務啟動的埠號
  compression:
    enabled: true                        # 開啟 Gzip 壓縮，減少 JSON 傳輸體積
    mime-types: application/json         # 指定壓縮 JSON 格式，提升前端載入速度
    min-response-size: 1024              # 只有超過 1KB 的回應才進行壓縮

spring:
  config:
    activate:
      on-profile: prod                   # 標記此文件僅在 prod 模式下啟用

  # [資料庫連線配置 - 針對 Neon Postgres]
  datasource:
    # 使用環境變數讀取連線字串，若無則報錯，確保帳密不寫死在代碼中
    url: jdbc:postgresql://${DB_HOST:ep-holy-mud-a1v9v56m-pooler.ap-southeast-1.aws.neon.tech}:${DB_PORT:5432}/${DB_NAME:neondb}?sslmode=require
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    
    # [HikariCP 連線池優化 - 針對 Serverless 特性]
    hikari:
      maximum-pool-size: 10              # 限制最大連線數，避免耗盡 Neon 額度
      minimum-idle: 0                    # 關鍵：設為 0 允許沒人時連線完全切斷，讓 Neon 進入休眠省錢
      idle-timeout: 60000                # 閒置 60 秒即釋放連線
      max-lifetime: 1740000              # 連線壽命 29 分鐘 (略低於資料庫 30 分鐘超時設定)
      connection-test-query: SELECT 1    # 每次拿連線前先測一下，確保連線沒因資料庫休眠而掛掉

  # [MyBatis 配置]
  mybatis:
    configuration:
      map-underscore-to-camel-case: true # 自動將資料庫 bond_yield 映射到 Java bondYield

# ===================================================================
# 自定義業務配置
# ===================================================================
app:
  cors:
    # 嚴格的白名單管理，禁止任何 localhost 或未授權網域存取
    allowed-origins:
      - https://enchu-8085a.web.app
      - https://enchu-8085a.firebaseapp.com
      - https://www.en-chu.com

# ===================================================================
# 日誌配置
# ===================================================================
logging:
  level:
    root: INFO                           # 正式環境只記錄重要資訊，不印 DEBUG 以節省空間
    com.en_chu.calculator_api_spring: INFO